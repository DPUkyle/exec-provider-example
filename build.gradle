import org.gradle.api.provider.ValueSourceParameters

import java.nio.charset.StandardCharsets

abstract class FooVersionPrinter extends DefaultTask {
    @Input
    abstract Property<String> getResult()

    @TaskAction
    void printVersion() {
        try {
            logger.quiet(result..getOrElse('Not installed'))
        } catch (Exception e) {
            throw new GradleException("HALP", e)
        }
    }
}

abstract class FooVersionValueSource implements ValueSource<String, ValueSourceParameters.None> {
    @Inject
    abstract ExecOperations getExecOperations()

    String obtain() {
        ByteArrayOutputStream output = new ByteArrayOutputStream()
        execOperations.exec {
            it.commandLine "foo", "--version"
            it.standardOutput = output
            it.ignoreExitValue = true
        }
        return new String(output.toByteArray(), StandardCharsets.UTF_8)
    }
}

tasks.register("printFooVersion", FooVersionPrinter) {
    it.result = providers.of(FooVersionValueSource) {}
}